<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="description" content="Presentation slides for FOSS4G:UK Local, November 2022">
		<meta name="author" content="Dr John A Stevenson">

		<title>RSECon24: SQLite for Scientists</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/bgs.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
		<style>
			.reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5 {
						  text-transform: none;
				  }
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">


<section>
	<section>
		<h2>SQLite for Scientists</h2>
		<p>
		<span class="small"><a href="https://www.bgs.ac.uk/people/stevenson-john/">Dr John A Stevenson</a> / <a href="https://fosstodon.org/@volcan01010">@volcan01010@fosstodon.org</a></span>
		</p>
		<a href="https://www.bgs.ac.uk"><img src="images/BGS-Logo-Pos-RGB.svg" width=300 style="background:white; border:15px solid white; box-shadow:none;"></a>
		<aside data-markdown class="notes">
			I am the Research Software Engineering Capability Lead at the British Geologial Survey.
			In the RSE spectrum, I began at 100% "writes papers", went all the way to 100% "writes code"
			and now sit at about 95% "writes code".
		</aside>
	</section>
	<section>
		<h3>Follow along on GitHub</h3>
		<img class="r-stretch" src="images/qr_code.svg">
		<p>
		<a href="https://github.com/volcan01010/RSECon24">https://github.com/volcan01010/RSECon24</a>
	    </p>
		<aside data-markdown class="notes">
			Scan QR code to follow the talk
		</aside>
	</section>
</section>


<section>
	<section>
		<h2>Databases and SQLite</h2>
		<aside data-markdown class="notes">
		</aside>
	</section>
	<section>
		<h3>Databases power applications</h3>
		<img class="r-stretch" src="images/switch_website.png">
		<aside data-markdown class="notes">
			+ At their simplest, databases are places to store tables of data for fast retrieval.
			+ All computer scientists taught about them.
			+ They are back-end technology, so are less obvious to others.
			+ https://uk.webuy.com/search?stext=nintendo+switch&availability=In+Stock+Online&categoryFriendlyName=Switch+Consoles&sellPrice=:200&Condition=Unboxed~Discounted&Model+Name=Switch
		</aside>
	</section>
	<section>
		<h3>Excel is not a database</h3>
		<img class="r-stretch" src="images/excel_gene_renaming.png">
		<aside data-markdown class="notes">
			Convenient interface to edit tables BUT
			+ Mixes formatting with content
			+ Code is hidden
			+ Sorting defaults to individual column
			+ Auto-complete changes data
			https://theconversation.com/excel-autocorrect-errors-still-plague-genetic-research-raising-concerns-over-scientific-rigour-166554
		</aside>
	</section>
	<section data-background-image="images/crowd_james_cridland.jpg" data-background-opacity=0.2>
		<h3>The most popular database in the world is</h3>
		<img class="center" src="images/SQLite370.svg", height="350">
		<aside data-markdown class="notes">
			+ Hands up who has heard of SQLite before today?
			+ Like more than 2 m from a rat isn't true, but you are never far
			  from a SQLite database - over 1 trillion have been deployed
			+ In every smart phone
            + "Crowd" by James Cridland is licensed under CC BY 2.0. To view a copy of this license, visit https://creativecommons.org/licenses/by/2.0/?ref=openverse.
			+ Similar local file to MS Access or LibreOffice base, but still a backend technology without GUI
		</aside>
	</section>
	<section>
		<h3>Comparison with PostgreSQL</h3>
		<table>
			<thead><tr>
				<th></th>
				<th><img src="images/SQLite370.svg" height=90></th>
				<th><img src="images/PostgreSQL_logo.3colors.svg" height=90></th>
			</thead></tr>
			<tr>
				<td>SQL language</td>
				<td>Yes</td>
				<td>Yes</td>
			</tr>
			<tr>
				<td>Storage</td>
				<td>Local</td>
				<td>Network</td>
			</tr>
			<tr>
				<td>Concurrent edits</td>
				<td>No</td>
				<td>Yes</td>
			</tr>
			<tr>
				<td>Enforced types</td>
				<td>No</td>
				<td>Yes</td>
			</tr>
			<tr>
				<td>User functions</td>
				<td>No</td>
				<td>Yes</td>
			</tr>
		</table>
		<aside data-markdown class="notes">
			SQL language,
			Constraints and data types
			Calculations and queries
			Normally in the backend
			Single file
			Types aren't enforced
			Use PostgreSQL if you need concurrent edits
			Access / LibreOffice Base are desktop tools
		</aside>
	</section>
	<section>
		<h3>DB Browser for SQLite</h3>
		<video class="r-stretch" controls src="images/db_browser_tour.mp4" type="video/mp4"></video>
		<aside data-markdown class="notes">
		Fully-featured, open-source GUI front-end for SQLite.
		</aside>
	</section>
</section>

<section>
	<section>
		<h2>Introduction to SQL</h2>
		<aside data-markdown class="notes">
			SQL stands for structured query language.
			Originally from 70s, but developed a standard in 1980s.
			It is used to query relational database management systems.
		</aside>
	</section>
	<section>
		<h3>SELECT extracts data</h3>
		<img class="r-stretch" src="images/volcano_01_select.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>Filters and sorting</h3>
		<img class="r-stretch" src="images/volcano_02_filter.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>JOIN combines tables</h3>
		<img class="r-stretch" src="images/volcano_03_join.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>GROUP BY aggregates values</h3>
		<img class="r-stretch" src="images/volcano_04_group_by.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>VIEWs store pre-calculated queries</h3>
		<img class="r-stretch" src="images/volcano_05_view.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
</section>

<section>
	<section>
		<h2>Useful tools</h2>
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>QGIS has nice forms...</h3>
		<video class="r-stretch" controls src="images/qgis_widgets_h264.mp4" type="video/mp4"></video>
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>...and understands relationships...</h3>
		<pre data-id="code-animation">
			<code class="hljs sql" data-line-numbers="2,5|10,12,16">
CREATE TABLE "H3H4_in_soil" (
	"fid" INTEGER PRIMARY KEY AUTOINCREMENT,
	"geometry" POINT,
	"locality" TEXT UNIQUE NOT NULL,
	"thickness" REAL,
	"notes" TEXT
);

CREATE TABLE "photos" (
	"fid" INTEGER PRIMARY KEY AUTOINCREMENT,
	"locality_id" TEXT,
	"file_path" TEXT,
	"notebook" BOOLEAN,
	"notes" TEXT,
	FOREIGN KEY("locality_id") REFERENCES "H3H4_in_soil"("locality")
);
		    </code>
		</pre>
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>...and understands relationships...</h3>
		<img class="r-stretch" src="images/hekla_relation_widget.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>...to give an efficient interface</h3>
		<video class="r-stretch" controls src="images/photo_form_demo.mp4" type="video/mp4"></video>
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>Datasette publishes data to the web...</h3>
		<img class="r-stretch" src="images/datasette_landing_page.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>...with sorting, filters and queries...</h3>
		<img class="r-stretch" src="images/datasette_web_query.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>...and an API for JSON and CSV</h3>
		<img class="r-stretch" src="images/datasette_json_query.png">
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
	<section>
		<h3>ETL Helper simplifies data access...</h3>
		<img class="r-stretch" src="images/etlhelper_pypi.png">
		<aside data-markdown class="notes">
			Python has sqlite3 in standard library
			Pandas can read/write from SQL tables via SQLAlchemy library
		</aside>
	</section>
	<section data-auto-animate>
		<h3>...and provides easy data pipelines</h3>
		<pre data-id="code-animation" class="r-stretch">
			<code class="hljs python" data-line-numbers="4-11|14-29|32-39">
...

CREATE_COUNTRY_SQL = """
    CREATE TABLE country (
        name TEXT,
        slug TEXT PRIMARY KEY,
        population INTEGER,
        ranking INTEGER,
        region TEXT
    );"""


def create_volcano_db():
    with sqlite3.connect(DB_FILE) as conn:
        etl.execute(CREATE_VOLCANO_SQL, conn)
        etl.execute(CREATE_COUNTRY_SQL, conn)
        etl.execute(CREATE_VIEW_SQL, conn)

        with open(VOLCANO_CSV, "rt") as f:
            next(f)  # Skip header
            next(f)  # Skip header
            reader = csv.DictReader(f)
            etl.load('volcano', conn, reader, transform=_transform_volcano)

        with open(COUNTRIES_CSV, "rt") as f:
            next(f)  # Skip header
            reader = csv.DictReader(f)
            etl.load('country', conn, reader, transform=_transform_country)


def _transform_country(chunk):
    """
    Drop empty data_of_information column, rename population and cast to int.
    """
    for row in chunk:
        row['population'] = int(row.pop('value').replace(',', ''))
        row.pop("date_of_information")
        yield row

...
		    </code>
		</pre>
		<aside data-markdown class="notes">
			-
		</aside>
	</section>
</section>

<section>
	<section>
		<h3>Thank you</h3>
		<aside data-markdown class="notes">
			Thank you.
		</aside>
	</section>
	<section data-markdown>
		<textarea data-template>
		### Links

		+ SQLite: [https://www.sqlite.org](https://www.sqlite.org)
		+ DB Browser for SQLite: [https://sqlitebrowser.org/](https://sqlitebrowser.org/)
		+ QGIS: [https://qgis.org/](https://qgis.org/)
		+ Datasette: [https://datasette.io/](https://datasette.io/)
		+ ETL Helper: [https://pypi.org/project/etlhelper/](https://pypi.org/project/etlhelper/)
		+ Reveal.js: [https://revealjs.com](https://revealjs.com)
		+ Segno (QR codes): [https://pypi.org/project/segno/](https://pypi.org/project/segno/)

		</textarea>
		<aside data-markdown class="notes">
			Thank you.
		</aside>
	</section>
</section>


	</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				width: 1152,
				height: 840,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
